# ElectricSQL Environment Configuration for OpenChat
# Copy this file to .env.electric.local and configure for your environment

# =============================================================================
# ELECTRIC SERVICE CONFIGURATION
# =============================================================================

# ElectricSQL service URL - where the Electric sync service is running
NEXT_PUBLIC_ELECTRIC_URL=http://localhost:5133

# ElectricSQL API key (if authentication is enabled)
NEXT_PUBLIC_ELECTRIC_API_KEY=your-electric-api-key

# Electric service environment (development, staging, production)
ELECTRIC_ENV=development

# Electric service port
ELECTRIC_PORT=5133

# Electric service host
ELECTRIC_HOST=0.0.0.0

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Primary database URL (PostgreSQL with logical replication enabled)
DATABASE_URL=postgresql://openchat:openchat_dev@localhost:5432/openchat

# Electric replication user credentials
ELECTRIC_REPLICATION_USER=electric_replication
ELECTRIC_REPLICATION_PASSWORD=electric_replication_password

# Database connection pool settings
DB_POOL_MAX_CONNECTIONS=20
DB_POOL_MIN_CONNECTIONS=5
DB_POOL_CONNECTION_TIMEOUT=10000
DB_POOL_IDLE_TIMEOUT=300000
DB_POOL_MAX_LIFETIME=1800000

# Replication slot and publication names
ELECTRIC_REPLICATION_SLOT=electric_main_slot
ELECTRIC_PUBLICATION_NAME=electric_publication

# =============================================================================
# AUTHENTICATION CONFIGURATION
# =============================================================================

# JWT secret key for token validation (use a strong, random key in production)
JWT_SECRET=your-super-secure-jwt-secret-key-change-this-in-production

# JWT issuer and audience
JWT_ISSUER=openchat
JWT_AUDIENCE=openchat-users

# Token expiration time
JWT_EXPIRES_IN=24h

# Custom authentication validation URL (if using custom auth mode)
AUTH_VALIDATION_URL=http://localhost:3000/api/auth/validate

# =============================================================================
# REDIS CONFIGURATION (for caching and session management)
# =============================================================================

# Redis URL for caching and session storage
REDIS_URL=redis://localhost:6379

# Redis database number for Electric-specific data
REDIS_ELECTRIC_DB=1

# Redis key prefix for Electric data
REDIS_KEY_PREFIX=electric:

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level (debug, info, warn, error)
LOG_LEVEL=info

# Log format (json, text)
LOG_FORMAT=json

# Enable file logging
LOG_TO_FILE=true

# Log file path
LOG_FILE_PATH=/var/log/electric/electric.log

# Maximum log file size
LOG_MAX_SIZE=100MB

# Number of log files to keep
LOG_MAX_BACKUPS=5

# Maximum age of log files (in days)
LOG_MAX_AGE=7

# =============================================================================
# MONITORING AND METRICS
# =============================================================================

# Enable Prometheus metrics
ENABLE_METRICS=true

# Metrics endpoint path
METRICS_PATH=/metrics

# Metrics reporting interval (milliseconds)
METRICS_INTERVAL=5000

# Health check endpoint path
HEALTH_CHECK_PATH=/health

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Maximum number of concurrent shape subscriptions per client
MAX_CONCURRENT_SHAPES=50

# Shape data retention settings
SHAPE_MEMORY_RETENTION=1h
SHAPE_DISK_RETENTION=24h

# Enable shape result caching
ENABLE_SHAPE_CACHING=true

# Shape cache TTL
SHAPE_CACHE_TTL=5m

# Maximum cache size per shape
SHAPE_MAX_CACHE_SIZE=100MB

# Batch processing settings
MAX_BATCH_SIZE=1000
BATCH_TIMEOUT=10s
ENABLE_BATCH_COMPRESSION=true

# Change stream settings
CHANGE_BUFFER_SIZE=10000
CHANGE_FLUSH_INTERVAL=100ms
CHANGE_MAX_AGE=1s

# =============================================================================
# NETWORK AND SECURITY
# =============================================================================

# CORS settings for web clients
CORS_ALLOWED_ORIGINS=http://localhost:3001,http://localhost:3000,https://openchat.example.com
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-Electric-User-ID,X-Electric-Device-ID
CORS_ALLOW_CREDENTIALS=true

# Request timeout and limits
REQUEST_TIMEOUT=30s
MAX_REQUEST_SIZE=10MB

# Rate limiting
ENABLE_RATE_LIMITING=true
RATE_LIMIT_REQUESTS_PER_SECOND=1000
RATE_LIMIT_BURST_SIZE=5000

# Connection limits
MAX_CONNECTIONS_PER_IP=100
MAX_CONNECTIONS_PER_USER=10

# TLS configuration
TLS_ENABLED=false
TLS_CERT_FILE=/path/to/cert.pem
TLS_KEY_FILE=/path/to/key.pem

# =============================================================================
# ERROR HANDLING AND RETRY
# =============================================================================

# Enable automatic error recovery
ENABLE_AUTO_RECOVERY=true

# Maximum recovery attempts
MAX_RECOVERY_ATTEMPTS=3

# Retry configuration
DEFAULT_MAX_RETRIES=3
DEFAULT_RETRY_DELAY=1000
ENABLE_EXPONENTIAL_BACKOFF=true
ENABLE_RETRY_JITTER=true

# Circuit breaker configuration
ENABLE_CIRCUIT_BREAKER=true
CIRCUIT_BREAKER_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=30000

# =============================================================================
# DEVELOPMENT AND DEBUGGING
# =============================================================================

# Enable development mode
DEVELOPMENT_MODE=true

# Enable hot reload
ENABLE_HOT_RELOAD=true

# Watch paths for hot reload
HOT_RELOAD_WATCH_PATHS=/app/config

# Enable debug endpoints
ENABLE_DEBUG_ENDPOINTS=true

# Debug endpoints to enable
DEBUG_ENDPOINTS=/debug/shapes,/debug/replication,/debug/connections

# Enable verbose logging for specific components
DEBUG_REPLICATION=false
DEBUG_AUTH=false
DEBUG_SHAPES=false
DEBUG_HTTP=false
DEBUG_DATABASE=false

# =============================================================================
# WEBHOOK AND NOTIFICATIONS
# =============================================================================

# Webhook URL for error notifications
ERROR_WEBHOOK_URL=https://your-webhook-service.com/webhooks/electric-errors

# Slack webhook for alerts (optional)
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK

# Email settings for notifications (optional)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
NOTIFICATION_EMAIL_FROM=openchat-electric@example.com
NOTIFICATION_EMAIL_TO=admin@example.com

# =============================================================================
# BACKUP AND DISASTER RECOVERY
# =============================================================================

# Enable automatic backups
ENABLE_AUTO_BACKUP=true

# Backup interval (in hours)
BACKUP_INTERVAL=24

# Backup retention period (in days)
BACKUP_RETENTION_DAYS=30

# Backup storage location
BACKUP_STORAGE_PATH=/backups/electric

# S3 backup configuration (optional)
BACKUP_S3_ENABLED=false
BACKUP_S3_BUCKET=your-backup-bucket
BACKUP_S3_REGION=us-east-1
BACKUP_S3_ACCESS_KEY_ID=your-access-key
BACKUP_S3_SECRET_ACCESS_KEY=your-secret-key

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Enable experimental features
ENABLE_EXPERIMENTAL_FEATURES=false

# Advanced shape filtering
ENABLE_ADVANCED_SHAPES=false

# Compressed change streams
ENABLE_COMPRESSED_STREAMS=false

# Real-time analytics
ENABLE_REALTIME_ANALYTICS=true

# Beta features
ENABLE_BETA_FEATURES=true

# Multi-tenant isolation
ENABLE_TENANT_ISOLATION=true

# Advanced caching
ENABLE_SMART_CACHING=true

# =============================================================================
# CLOUD PROVIDER SPECIFIC SETTINGS
# =============================================================================

# AWS specific settings
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key

# Azure specific settings
AZURE_SUBSCRIPTION_ID=your-azure-subscription-id
AZURE_RESOURCE_GROUP=your-resource-group
AZURE_CLIENT_ID=your-azure-client-id
AZURE_CLIENT_SECRET=your-azure-client-secret

# Google Cloud specific settings
GOOGLE_CLOUD_PROJECT_ID=your-gcp-project-id
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# =============================================================================
# ENVIRONMENT-SPECIFIC OVERRIDES
# =============================================================================

# Development environment specific
DEV_DATABASE_URL=postgresql://openchat_dev:openchat_dev@localhost:5432/openchat_dev
DEV_ELECTRIC_URL=http://localhost:5133
DEV_LOG_LEVEL=debug

# Staging environment specific
STAGING_DATABASE_URL=postgresql://openchat_staging:staging_password@staging-db:5432/openchat_staging
STAGING_ELECTRIC_URL=https://electric-staging.openchat.com
STAGING_LOG_LEVEL=info

# Production environment specific
PROD_DATABASE_URL=postgresql://openchat_prod:production_password@prod-db:5432/openchat_prod
PROD_ELECTRIC_URL=https://electric.openchat.com
PROD_LOG_LEVEL=warn

# =============================================================================
# ADDITIONAL CONFIGURATION
# =============================================================================

# Custom configuration file path
ELECTRIC_CONFIG_FILE=/etc/electric/config.yaml

# Plugin directory
ELECTRIC_PLUGINS_DIR=/etc/electric/plugins

# Custom shape definitions directory
ELECTRIC_SHAPES_DIR=/etc/electric/shapes

# Migration scripts directory
ELECTRIC_MIGRATIONS_DIR=/etc/electric/migrations